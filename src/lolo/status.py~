#!/usr/bin/python

import os
import sys
import json
import subprocess

FILENAME = "status.json"

def change_status():
	'''Changes status
	
	Gets called from lolo_serial'''
	
	# pulls in previous Labs status (reads from JSON file)
	status = load_status()

	# changes status between open & closed (Boolean)
	# also toggles symbolic link between open & closed image as current status image
	if status['open'] is True:
		status['open'] = False
		status['status'] = "091 Labs is closed atm!"
		subprocess.call(["ln","-s","/var/www/lolo/images/closed.png","/var/www/lolo/images/status.png"])
	else:
		status['open'] = True
		status['status'] = "091 Labs is open!"
		subprocess.call(["ln","-s","/var/www/lolo/images/open.png","/var/www/lolo/images/status.png"])
		
	# sends on the current Labs status (writes back to JSON file)
	save_status(status)

def load_status():
	'''Loads JSON data from FILENAME'''
	
	with open(FILENAME, "r") as FILE:
		data = FILE.read()			# read data
	return json.loads(data)		# JSON formatted data converted in python object
	
def save_status(status):
	'''Writes JSON data to FILENAME'''
	
	with open(FILENAME, "w") as FILE:
		data = json.dumps(status)	# python object converted into JSON formatted data
		FILE.write(data)			# write data to file

if __name__ == '__main__':
	change_status()
